<!DOCTYPE html>
<html>
   <head>
        <% include partials/head %>
    </head>
   <body>
      <section class="pb_cover_v3 cover-bg-opacity text-left pb_gradient_v1">
         <div class="container">
            <div class="row align-items-center justify-content-center">
              
               
               <div class="col-md-6 relative align-self-center join-today-index">
                  <div class="text-center err-msg">Message</div>
                  <div class="panel panel-default">
                     <div class="panel-heading">
                        <h3 class="panel-title text-center">Login.</h3>
                     </div>
                     <div class="panel-body">
                        <form class="needs-validation" novalidate>
                           
                              
                              
                           <div class="form-row">
                              <div class="col-md-12 mb-3">
                                 <label for="email">Email</label>
                                 <div class="input-group">
                                    <div class="input-group-prepend">
                                    </div>
                                    <input type="email" class="form-control" value="adrian@adriannadeau.com" id="email" required>
                                    <div class="invalid-feedback">
                                       Please enter a valid email.
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="form-row">
                              <div class="col-md-12 mb-3">
                                 <label for="email">Password</label>
                                 <div class="input-group">
                                    <input type="password" class="form-control" id="password"  value="password" required>
                                    <div class="invalid-feedback">
                                       Please enter a valid password.
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <button class="col-md-12 btn btn-primary btn-lg btn-block pb_btn-pill  btn-shadow-blue text-center" type="submit">Login</button><br/>
                            
                            <div class="col-md-12 mb-3 md-form text-center" style="padding-top:20px">Not a member? <a style="color:green !important;" href="index.jsp">Register here.</a>
                             </div>
                     </div>
                     
                     
                     </div>
                     </div>
                 </div>
                  </form>
                  
                  
               </div>
            </div>
         </div>
         </div>
      </section>
      <% include partials/footer %>
       <% include partials/scripts %>
      
    </body>
   <script type="text/javascript">
      $( document ).ready(function() {
         // Handler for .ready() called. 
         $(".err-msg").hide();
         
      });
         (function() {
             'use strict';
             window.addEventListener('load', function() {
                 // Fetch all the forms we want to apply custom Bootstrap validation styles to
                 var forms = document.getElementsByClassName('needs-validation');
                 // Loop over them and prevent submission
                 var validation = Array.prototype.filter.call(forms, function(form) {
                 form.addEventListener('submit', function(event) {
                 if (form.checkValidity() === false) {
                    event.preventDefault();
                     
                 }
                 else{
                     event.preventDefault();
                     var email = $("#email").val();
                     console.log(email);
                     var password = $("#password").val();
                     
                    if( email != "" && password != "" ){
                        $.ajax({
                              url: '/users/login',
                              type: "POST",
                              dataType: "json",
                              data: {
                              email: email,
                              password: password
                              },


                               /**
                               * A function to be called if the request succeeds.
                               */
                               success: function(data, textStatus, jqXHR) {
                                console.log("id : "+data._id);
                                 window.location.assign("/profile/?id="+data._id);
                                 
                                //var url = "http://localhost:3000/users/profile/?id="+data.result._id;
                                 
                               },
                              /**
                               * A function to be called if the request fails. 
                               */
                              error: function(jqXHR, textStatus, errorThrown) {
                                  $(".err-msg").html('Error logging in, please confirm username and password are correct');
                                  $(".err-msg").show();
                                 //alert('An error occurred');
                            
                              }

                             
                        });
                     }
    



///////////////////////////////////////////////////////////

               }
                 
              form.classList.add('was-validated');
             }, false);
         });
         }, false);
         })();
        
         

      </script>
</html>
