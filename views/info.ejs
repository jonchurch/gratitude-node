<!DOCTYPE html>
<html>
   <head>
        <% include partials/head %>
    </head>
   <body>
      <section class="pb_cover_v3 cover-bg-opacity text-left pb_gradient_v1">
         <div class="container">
            <div class="row align-items-center justify-content-center">
              
               
               <div class="col-md-6 relative align-self-center join-today-index">
                   <!-- <div class="alert alert-danger err-msg" role="alert"></div> -->
                  <div class="panel panel-default">
                     <div class="panel-heading">
                        <h3 class="text-center">Welcome <span id="name"></span>.</h3>
                        <p class="text-center">Don't worry, this can be done later!</p>
                     </div>
                     <div class="panel-body">
                        <form id="moreInfoForm">
                           
                              
                              
                           <div class="form-row">
                              <div class="col-md-12 mb-3">
                                
                                 <div class="input-group">
                                    <div class="input-group-prepend">
                                    </div>
                                    <div class="form-group shadow-textarea">
                                    <label for="bio">Let us know a little about you</label>
                                    <textarea class="form-control z-depth-1" id="bio" rows="5"></textarea>
                                    </div>
                                    
                                 </div>
                              </div>
                           </div>
                           <div class="form-row">
                              <div class="col-md-12 mb-3">
                                 <label for="location">Address</label>
                                 <div class="input-group">
                                    <input type="text" class="form-control" id="location" >
                                    
                                 </div>
                              </div>
                           </div>
                           <!-- <div class="form-row">
                              <div class="col-md-12 mb-3">
                                 
                               
                                <img src="/images/coverphotos/profile.jpg" class="rounded-circle z-depth-1-half avatar-pic" alt="example placeholder avatar">
                                
                               </div>     
                                <div class="btn btn-mdb-color btn-rounded float-left">
                                
                                <input type="file">
                            </div> -->
                            
                           </div>
                           
                           <div class="col-md-12 mb-3">
                               <br/><br/>
                               <div class="col-md-6"><button class="btn btn-primary btn-lg btn-block pb_btn-pill  btn-shadow-blue text-center" id="btn_skip">Skip</button></div>
                               <div class="col-md-6"><button class="btn btn-primary btn-lg btn-block pb_btn-pill  btn-shadow-blue text-center" id="btn_save">Save</button></div>
                               
                            
                           
                            </div>
                        </div>
                     </div>
                 </div>
                  </form>
                  
                  
               </div>
            </div>
         </div>
         </div>
      </section>
      <% include partials/footer %>
       <% include partials/scripts %>
      
    </body>
    <script>

    $(document).ready(function() {
      
        var _id=($.urlParam('id'));
        var passId;
    
      console.log("id: "+_id);
      //call get user
      $.ajax({
          url: '/users/'+_id,
          type: "GET",
          dataType: "json",
          data: {id: _id},
            success: function(data, textStatus, jqXHR) {
                   //set first name, lastname, email, avatar 
                    $("#name").html(data.firstname+" "+data.lastname);
                    passId=data._id;
                   
            },
            error: function(jqXHR, textStatus, errorThrown) {
                    console.log('Error occurred on info.ejs');
                    
            }
        }); 
        $("#btn_skip").click(function() {
            event.preventDefault();
            console.log("pass:"+passId);
            
            window.location.assign("/profile/?id="+passId);
            
        });
        $("#btn_save").click(function() {
            console.log("save info")
            var _id=($.urlParam('id'));
          console.log("param value: "+_id);
            event.preventDefault();
             
            // PREPARE FORM DATA
            console.log("start ajax...");
             $.ajax({
                url: '/info/',
                type: "PUT",
                dataType: "json",
                data: {
                    _id:_id,
                    bio: $("#bio").val(),
                    location: $("#location").val()
                },
               
                success: function(data, textStatus, jqXHR) {
                    console.log("id : "+data._id);
                    window.location.assign("/profile/?id="+data._id);
                },
                error : function(error) {
                    console.log(error);
                    if(error.status==500){
                        $(".err-msg").html("Error logging again, please try again.");
                        $(".err-msg").show(); 
                    }
                }
            });

            // $.ajax({
            //       type : "POST",
            //       data : JSON.stringify(formData),
            //       contentType : "application/json",
            //       url : "/info/"+passId,
            //       success : function(customer) {
            //           //forward page with id to fill in optional information
            //           console.log("id : "+customer._id);
            //         window.location.assign("/profile/?id="+customer._id);
                    
            //       },
            //       error : function(error) {
            //           console.log(error);
            //           if(error.status==500){
            //              $(".err-msg").html("Error.");
            //             $(".err-msg").show(); 
            //           }
            //       }
            //    });
               
    	

            
         });
        
  });  
</script>
</html>